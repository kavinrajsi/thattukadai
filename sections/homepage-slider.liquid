{%- comment -%}
  Home Page Slider - Flickity Version
  ------------------------------------
  Features:
  - Mobile, tablet, and desktop images
  - Custom alt text for images
  - Individual image links
  - Layout shift prevention
  - Image preloading and high priority loading
  - No text content or buttons
  - Uses Flickity for better performance
{%- endcomment -%}

<noscript>
  <style>
    /* When JS is off, show the images stacked as a graceful fallback */
    .homepage-slider {
      visibility: visible !important;
    }
  </style>
</noscript>

{% if section.settings.height_mode == 'fixed' %}
  #homepage-slider-{{ section.id }} .flickity-viewport { height: {{ section.settings.fixed_height }}px !important; }
  #homepage-slider-{{ section.id }} .flickity-slider__img { height: {{ section.settings.fixed_height }}px; width: 100%;
  object-fit: cover; object-position: {{ block.settings.image_position | default: 'center center' }}; }
{% endif %}
<div class="homepage-sliderWrapper">
  <div id="homepage-slider-{{ section.id }}" class="homepage-slider main-carousel">
    {%- for block in section.blocks -%}
      {% assign img_desktop = block.settings.image_desktop %}
      {% assign img_tablet = block.settings.image_tablet | default: block.settings.image_desktop %}
      {% assign img_mobile = block.settings.image_mobile
        | default: block.settings.image_tablet
        | default: block.settings.image_desktop
      %}
      {% assign img_alt = block.settings.image_alt | default: 'Slide image' %}

      <div class="carousel-cell">
        {% if img_desktop != blank %}
          <picture class="flickity-slider__media">
            {% comment %} Mobile image (up to 767px) {% endcomment %}
            {% if img_mobile and img_mobile != img_desktop %}
              <source
                media="(max-width: 767px)"
                srcset="
                  {{ img_mobile | image_url: width: 800 }} 800w,
                  {{ img_mobile | image_url: width: 1200 }} 1200w
                "
                sizes="100vw"
              >
            {% endif %}

            {% comment %} Tablet image (768px to 1023px) {% endcomment %}
            {% if img_tablet and img_tablet != img_desktop %}
              <source
                media="(min-width: 768px) and (max-width: 1023px)"
                srcset="
                  {{ img_tablet | image_url: width: 1024 }} 1024w,
                  {{ img_tablet | image_url: width: 1536 }} 1536w
                "
                sizes="100vw"
              >
            {% endif %}

            {% comment %} Desktop image (1024px and up) {% endcomment %}
            <img
              class="flickity-slider__img"
              src="{{ img_desktop | image_url: width: 1920 }}"
              srcset="
                {{ img_desktop | image_url: width: 1920 }} 1920w,
                {{ img_desktop | image_url: width: 2400 }} 2400w
              "
              sizes="100vw"
              width="{{ img_desktop.width }}"
              height="{{ img_desktop.height }}"
              alt="{{ img_alt | escape }}"
              {% if forloop.first %}
                loading="eager"
                fetchpriority="high"
              {% else %}
                loading="lazy"
              {% endif %}
              decoding="async"
            >
          </picture>
        {% endif %}
      </div>
    {%- endfor -%}
  </div>
  <!-- Section Divider -->
  <div class="section-divider" aria-hidden="true">
    <!-- Mobile shape -->
    <svg
      class="section-divider__svg section-divider__svg--mobile"
      viewBox="0 0 856 58"
      preserveAspectRatio="xMidYMid meet"
      role="presentation"
    >
      <g transform="translate(0,58) scale(0.1,-0.1)" fill="currentColor" stroke="none">
        <path d="M3805 573 c-1099 -22 -2368 -141 -3755 -351 l-45 -7 -3 -108 -3 -107
          4281 0 4281 0 -3 107 -3 107 -212 32 c-1613 244 -3158 356 -4538 327z"></path>
      </g>
    </svg>

    <!-- Desktop shape -->
    <svg
      class="section-divider__svg section-divider__svg--desktop"
      viewBox="0 0 2880 160"
      preserveAspectRatio="xMidYMid meet"
      role="presentation"
    >
      <g transform="translate(0,160) scale(0.1,-0.1)" fill="currentColor" stroke="none">
        <path d="M13090 1594 c-1208 -29 -1864 -53 -2820 -104 -2993 -162 -6317 -513
          -9655 -1021 -253 -38 -495 -75 -537 -81 l-78 -11 0 -189 0 -188 14400 0 14400
          0 0 188 0 188 -142 22 c-79 12 -294 44 -478 72 -3498 530 -6979 889 -10065
          1039 -624 31 -1020 46 -1815 72 -295 9 -2910 20 -3210 13z"></path>
      </g>
    </svg>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    var sliderEl = document.getElementById('homepage-slider-{{ section.id }}');
    if (!sliderEl || typeof Flickity === 'undefined') return;

    var hasMultipleSlides = sliderEl.querySelectorAll('.carousel-cell').length > 1;

    var flkty = new Flickity(sliderEl, {
      cellAlign: 'center',
      contain: true,
      wrapAround: {{ section.settings.loop | json }},
      prevNextButtons: hasMultipleSlides ? {{ section.settings.nav | json }} : false,
      pageDots: hasMultipleSlides ? {{ section.settings.dots | json }} : false,
      autoPlay: {{ section.settings.autoplay | json }} ? {{ section.settings.autoplay_timeout | times: 1000 }} : false,
      pauseAutoPlayOnHover: {{ section.settings.pause_on_hover | json }},
      imagesLoaded: true,
      groupCells: 1,
      draggable: true,
      percentPosition: true
    });

    // Optional: if you used a custom class like 'is-ready'
    flkty.on('ready', function () {
      sliderEl.classList.add('is-ready');
    });
  });
</script>

{% schema %}
{
  "name": "Slider",
  "tag": "section",
  "class": "section--homepage-slider",
  "settings": [
    {
      "type": "header",
      "content": "Slider Settings"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Auto-rotate slides",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_timeout",
      "label": "Change slide every (seconds)",
      "min": 2,
      "max": 12,
      "step": 1,
      "unit": "s",
      "default": 5
    },
    {
      "type": "checkbox",
      "id": "loop",
      "label": "Loop slides",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "nav",
      "label": "Show navigation arrows",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "dots",
      "label": "Show dots navigation",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "pause_on_hover",
      "label": "Pause on hover",
      "default": true
    },
    {
      "type": "header",
      "content": "Height Settings"
    },
    {
      "type": "select",
      "id": "height_mode",
      "label": "Height mode",
      "default": "auto",
      "options": [
        {
          "value": "auto",
          "label": "Auto height (based on image)"
        },
        {
          "value": "fixed",
          "label": "Fixed height"
        }
      ]
    },
    {
      "type": "range",
      "id": "fixed_height",
      "label": "Fixed height (px)",
      "min": 200,
      "max": 800,
      "step": 10,
      "default": 400,
      "info": "Only applies when height mode is set to 'Fixed height'"
    },
    {
      "type": "header",
      "content": "Section Design"
    },
    {
      "type": "color",
      "id": "divider_color",
      "label": "Divider color",
      "default": "#F6F6F6"
    },
    {
      "type": "color",
      "id": "nav_color",
      "label": "Navigation color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "nav_bg_color",
      "label": "Navigation background",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "dots_color",
      "label": "Dots color",
      "default": "#FFFFFF"
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Image Slide",
      "settings": [
        {
          "type": "header",
          "content": "Images"
        },
        {
          "type": "image_picker",
          "id": "image_desktop",
          "label": "Desktop image",
          "info": "Recommended: 1920x1080px or larger. Used for screens 1024px and up."
        },
        {
          "type": "image_picker",
          "id": "image_tablet",
          "label": "Tablet image (optional)",
          "info": "Recommended: 1024x768px. Used for screens 768px to 1023px. Uses desktop image if not set."
        },
        {
          "type": "image_picker",
          "id": "image_mobile",
          "label": "Mobile image (optional)",
          "info": "Recommended: 800x1200px. Used for screens up to 767px. Uses tablet/desktop image if not set."
        },
        {
          "type": "header",
          "content": "Settings"
        },
        {
          "type": "text",
          "id": "image_alt",
          "label": "Image description (alt text)",
          "info": "Describe the image for accessibility and SEO. Required for screen readers.",
          "placeholder": "Describe what's shown in the image"
        },
        {
          "type": "url",
          "id": "image_link",
          "label": "Image link (optional)",
          "info": "Makes the entire image clickable. Leave blank for no link."
        },
        {
          "type": "select",
          "id": "image_position",
          "label": "Image focal point",
          "info": "Adjust how the image is positioned when cropped",
          "default": "center center",
          "options": [
            {
              "value": "top left",
              "label": "Top Left"
            },
            {
              "value": "top center",
              "label": "Top Center"
            },
            {
              "value": "top right",
              "label": "Top Right"
            },
            {
              "value": "center left",
              "label": "Center Left"
            },
            {
              "value": "center center",
              "label": "Center"
            },
            {
              "value": "center right",
              "label": "Center Right"
            },
            {
              "value": "bottom left",
              "label": "Bottom Left"
            },
            {
              "value": "bottom center",
              "label": "Bottom Center"
            },
            {
              "value": "bottom right",
              "label": "Bottom Right"
            }
          ]
        }
      ]
    }
  ],
  "max_blocks": 10,
  "presets": [
    {
      "name": "Slider",
      "category": "Image",
      "blocks": [
        {
          "type": "slide"
        },
        {
          "type": "slide"
        },
        {
          "type": "slide"
        }
      ]
    }
  ]
}
{% endschema %}
