{% comment %}
  Shopify Collection Section
  --------------------------------

  üìå Purpose:
  - Displays a specific collection page with optional filters, sorting, and pagination.
  - Also displays a selected blog article or the latest from a selected blog.

  üß± Structure:
  - Collection image, title, and description
  - Sort dropdown (optional)
  - Filter by tag (optional)
  - Product grid with pagination (optional)
  - Blog article (optional, fallback to latest)

  üõ† Admin Settings:
  - Toggle to show/hide pagination
  - Toggle to show/hide filters (by tag)
  - Toggle to show/hide sorting dropdown
  - Collection picker
  - Blog picker
  - Article picker (optional)

  üì¶ JSON-LD Schema:
  - Outputs a list of up to 10 products for SEO using schema.org's `ItemList` type

  ‚úÖ Accessibility:
  - ARIA labels on pagination
  - Label elements for sorting and filtering

  üîÅ Preset:
  - Name: "Collection"
{% endcomment %}

<!-- Preload product imagery for the current collection page -->
{% if collection.products_count > 0 %}
  {% for product in collection.products %}
    {% if product.featured_image %}
      <link
        rel="preload"
        as="image"
        href="{{ product.featured_image | image_url: width: 530, height: 640, crop: 'center', format: 'jpg' }}"
        imagesrcset="{{ product.featured_image | image_url: width: 265, height: 320, crop: 'center', format: 'jpg' }} 265w, {{ product.featured_image | image_url: width: 530, height: 640, crop: 'center', format: 'jpg' }} 530w"
        imagesizes="(max-width: 749px) 50vw, (max-width: 999px) 33vw, 25vw"
      >
    {% endif %}
    {% assign second_image = product.images[1] %}
    {% if second_image %}
      <link
        rel="preload"
        as="image"
        href="{{ second_image | image_url: width: 530, height: 640, crop: 'center', format: 'jpg' }}"
        imagesrcset="{{ second_image | image_url: width: 265, height: 320, crop: 'center', format: 'jpg' }} 265w, {{ second_image | image_url: width: 530, height: 640, crop: 'center', format: 'jpg' }} 530w"
        imagesizes="(max-width: 749px) 50vw, (max-width: 999px) 33vw, 25vw"
      >
    {% endif %}
  {% endfor %}
{% endif %}

<!-- Main container for the collection page -->
<div class="collection-page">
  <!-- Display collection image if one is assigned -->
  {% if section.settings.show_image %}
    <div class="layout__grid-fluid padding--left-0 padding--right-0">
      <div class="collection-image">
        {% if collection.image %}
          <img
            src="{{ collection.image | image_url: width: 1600 }}"
            alt="{{ collection.image.alt | escape }}"
            width="{{ collection.image.width }}"
            height="{{ collection.image.height }}"
            loading="lazy"
          >
        {% else %}
          <img
            src="https://cdn.shopify.com/s/files/1/0768/1848/1375/files/vsthattukadai-collection-banner.webp?v=1760618234"
            alt="Default collection image"
            width=""
            height="520"
            loading="lazy"
          >
        {% endif %}
      </div>
    </div>
  {% endif %}

  <!-- Product listing section with pagination -->
  <section id="main-collection" class="layout__grid-box">
    {% if collection.description != blank %}
      <p>{{ collection.description }}</p>
    {% endif %}

    {% if section.settings.menu != blank or collection.handle == 'all' %}
      <nav class="collection-nav">
        <ul>
          <li><span>Filter By</span></li>

          {% assign nav_menu = section.settings.menu | default: 'main-menu' %}

          {% for link in linklists[nav_menu].links %}
            <li>
              {% assign is_active = false %}

              {% if link.type == 'collection_link' and link.object.handle == collection.handle %}
                {% assign is_active = true %}
              {% elsif collection.handle == 'all' and link.url == routes.all_products_collection_url %}
                {% assign is_active = true %}
              {% elsif collection.handle == 'all' and link.url contains routes.all_products_collection_url %}
                {% assign is_active = true %}
              {% endif %}

              <a
                href="{{ link.url }}"
                class="{% if is_active %}active{% endif %}"
                title="{{ link.title }}"
              >
                {{ link.title }}
              </a>
            </li>
          {% endfor %}
        </ul>
      </nav>
    {% endif %}

    {% paginate collection.products by 24 %}
      <div
        class="collection-list-grid"
        collection-list-mobile="2"
        collection-list-tablet="3"
        collection-list-desktop="4"
      >
        {% for product in collection.products %}
          {% render 'product-card', product: product %}
        {% endfor %}
      </div>
      <!-- Pagination controls -->
      <nav class="pagination">
        {%- if paginate.previous -%}
          <a href="{{ paginate.previous.url }}" class="pagination__button--prev" aria-label="Previous">
            <!-- Left arrow SVG -->
            <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M8.56963 11.4571L16.9291 3.4921C17.0686 3.35909 17.2539 3.28491 17.4466 3.28491C17.6393 3.28491 17.8246 3.35909 17.9641 3.4921L17.9731 3.5011C18.041 3.5655 18.095 3.64308 18.1319 3.72909C18.1688 3.81509 18.1878 3.9077 18.1878 4.00129C18.1878 4.09488 18.1688 4.1875 18.1319 4.2735C18.095 4.3595 18.041 4.43708 17.9731 4.50154L10.1011 12.0015L17.9731 19.4985C18.041 19.5629 18.095 19.6405 18.1319 19.7265C18.1688 19.8125 18.1878 19.9051 18.1878 19.9987C18.1878 20.0923 18.1688 20.1849 18.1319 20.2709C18.095 20.3569 18.041 20.4345 17.9731 20.4989L17.9641 20.5079C17.8246 20.6409 17.6393 20.7151 17.4466 20.7151C17.2539 20.7151 17.0686 20.6409 16.9291 20.5079L8.56963 12.5429C8.49601 12.4728 8.4375 12.3886 8.39748 12.2952C8.35746 12.2019 8.33687 12.1014 8.33687 11.9999C8.33687 11.8983 8.35746 11.7978 8.39748 11.7045C8.4375 11.6111 8.49601 11.5269 8.56963 11.4571Z" fill="#660808"/>
            </svg>
          </a>
        {%- endif -%}
        {%- for part in paginate.parts -%}
          {% if part.title == '&hellip;' %}
            <span class="pagination__page--decorative">‚Ä¶</span>
          {% elsif part.is_link %}
            <a class="pagination__page" href="{{ part.url }}">{{ part.title }}</a>
          {% else %}
            <span class="pagination__page--current">{{ part.title }}</span>
          {% endif %}
        {%- endfor -%}
        {%- if paginate.next -%}
          <a href="{{ paginate.next.url }}" class="pagination__button--next" aria-label="Next">
            <!-- Right arrow SVG -->
            <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M16.4304 12.5429L8.07094 20.5079C7.93145 20.6409 7.74614 20.7151 7.55344 20.7151C7.36073 20.7151 7.17542 20.6409 7.03594 20.5079L7.02694 20.4989C6.95908 20.4345 6.90505 20.3569 6.86813 20.2709C6.83121 20.1849 6.81217 20.0923 6.81217 19.9987C6.81217 19.9051 6.83121 19.8125 6.86813 19.7265C6.90505 19.6405 6.95908 19.5629 7.02694 19.4984L14.8989 11.9984L7.02694 4.50144C6.95908 4.43698 6.90505 4.35939 6.86813 4.27339C6.83121 4.1874 6.81217 4.09478 6.81217 4.00119C6.81217 3.9076 6.83121 3.81499 6.86813 3.72899C6.90505 3.64299 6.95908 3.5654 7.02694 3.50094L7.03594 3.49194C7.17542 3.35898 7.36073 3.2848 7.55344 3.2848C7.74614 3.2848 7.93145 3.35898 8.07094 3.49194L16.4304 11.4569C16.504 11.527 16.5625 11.6112 16.6025 11.7046C16.6425 11.7979 16.6631 11.8984 16.6631 11.9999C16.6631 12.1015 16.6425 12.202 16.6025 12.2953C16.5625 12.3887 16.504 12.4729 16.4304 12.5429Z" fill="#660808"/>
            </svg>
          </a>
        {%- endif -%}
      </nav>
    {% endpaginate %}
  </section>
</div>

<!-- SEO Structured Data using JSON-LD for Google -->
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "ItemList",
    "itemListElement": [
      {% for product in collection.products limit: 10 %}
      {
        "@type": "ListItem",
        "position": {{ forloop.index }},
        "name": "{{ product.title }}",
        "url": "{{ shop.secure_url }}{{ product.url }}"
      }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
  }
</script>

<!-- Schema for Theme Settings -->
{% schema %}
{
  "name": "Collection",
  "tag": "section",
  "class": "collection",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_image",
      "label": "Show collection image",
      "default": true
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Navigation menu"
    }
  ],
  "presets": [
    {
      "name": "Collection - Default",
      "category": "Collection"
    }
  ]
}
{% endschema %}
