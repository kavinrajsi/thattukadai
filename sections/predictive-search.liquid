{%- comment -%}
  Renders predictive search results (HTML is fetched via /search/suggest?section_id=predictive-search)
  Docs: https://shopify.dev/docs/storefronts/themes/navigation-search/search/predictive-search
{%- endcomment -%}

{% comment %} {%- assign trending_keywords = 'summer collection, bestsellers, new arrivals, trending now' | split: ', ' -%} {% endcomment %}
{% comment %} {%- assign popular_products = collections.featured.products | limit: 6 -%} {% endcomment %}

{%- if predictive_search.performed -%}
  <div class="predictive-search__results" role="region" aria-label="Search suggestions">
    {%- assign found_any = false -%}
    {%- assign has_products = false -%}
    {%- assign has_collections = false -%}

    {%- if predictive_search.resources.products.size > 0 -%}
      {%- assign found_any = true -%}
      {%- assign has_products = true -%}
    {%- endif -%}

    {%- if predictive_search.resources.collections.size > 0 -%}
      {%- assign found_any = true -%}
      {%- assign has_collections = true -%}
    {%- endif -%}

    {%- if predictive_search.resources.articles.size > 0 -%}
      {%- assign found_any = true -%}
    {%- endif -%}

    {%- comment -%} Show collections only if no products, or show both in split layout {%- endcomment -%}
    <div class="predictive-search__content">
      {%- if has_collections and has_products -%}
        {%- comment -%} Both collections and products - split layout {%- endcomment -%}
        <div class="predictive-search__split">
          <div class="predictive-search__split-left">
            <h3 class="predictive-search__heading">Collections</h3>
            <ul
              class="predictive-search__list predictive-search__list--collections"
              role="listbox"
              aria-labelledby="predictive-search-collections"
            >
              {%- for collection in predictive_search.resources.collections -%}
                <li class="predictive-search__item" role="option">
                  <a class="predictive-search__link" href="{{ collection.url }}">
                    {{
                      collection.featured_image
                      | image_url: width: 238, height: 238
                      | image_tag: alt: collection.title, loading: 'lazy', class: 'predictive-search__image'
                    }}
                    <span class="predictive-search__title">{{ collection.title }}</span>
                  </a>
                </li>
              {%- endfor -%}
            </ul>
          </div>

          <div class="predictive-search__split-right">
            <h3 class="predictive-search__heading">Products</h3>
            <ul
              class="predictive-search__list predictive-search__list--products"
              role="listbox"
              aria-labelledby="predictive-search-products"
            >
              {%- for product in predictive_search.resources.products -%}
                <li class="predictive-search__item" role="option">
                  <a class="predictive-search__link" href="{{ product.url }}">
                    {{
                      product
                      | image_url: width: 238, height: 238
                      | image_tag: alt: product.title, loading: 'lazy', class: 'predictive-search__image'
                    }}
                    <span class="predictive-search__title">{{ product.title }}</span>
                    {%- if product.price -%}
                      <span class="predictive-search__price">
                        {%- if product.compare_at_price > product.price -%}
                          <s>{{ product.compare_at_price | money }}</s>
                        {%- endif -%}
                        {{ product.price | money }}
                      </span>
                    {%- endif -%}
                  </a>
                </li>
              {%- endfor -%}
            </ul>
          </div>
        </div>

      {%- elsif has_collections -%}
        {%- comment -%} Collections only {%- endcomment -%}
        <h3 class="predictive-search__heading">Collections</h3>
        <ul
          class="predictive-search__list predictive-search__list--collections"
          role="listbox"
          aria-labelledby="predictive-search-collections"
        >
          {%- for collection in predictive_search.resources.collections -%}
            <li class="predictive-search__item" role="option">
              <a class="predictive-search__link" href="{{ collection.url }}">
                {{
                  collection.featured_image
                  | image_url: width: 238, height: 238
                  | image_tag: alt: collection.title, loading: 'lazy', class: 'predictive-search__image'
                }}
                <span class="predictive-search__title">{{ collection.title }}</span>
              </a>
            </li>
          {%- endfor -%}
        </ul>

      {%- elsif has_products -%}
        {%- comment -%} Products only {%- endcomment -%}
        <h3 class="predictive-search__heading">Products</h3>
        <ul
          class="predictive-search__list predictive-search__list--products"
          role="listbox"
          aria-labelledby="predictive-search-products"
        >
          {%- for product in predictive_search.resources.products -%}
            <li class="predictive-search__item" role="option">
              <a class="predictive-search__link" href="{{ product.url }}">
                {{
                  product
                  | image_url: width: 238, height: 238
                  | image_tag: alt: product.title, loading: 'lazy', class: 'predictive-search__image'
                }}
                <span class="predictive-search__title">{{ product.title }}</span>
                {%- if product.price -%}
                  <span class="predictive-search__price">
                    {%- if product.compare_at_price > product.price -%}
                      <s>{{ product.compare_at_price | money }}</s>
                    {%- endif -%}
                    {{ product.price | money }}
                  </span>
                {%- endif -%}
              </a>
            </li>
          {%- endfor -%}
        </ul>
      {%- endif -%}

      {%- if predictive_search.resources.articles.size > 0 -%}
        <h3 class="predictive-search__heading">Articles</h3>
        <ul
          class="predictive-search__list predictive-search__list--articles"
          role="listbox"
          aria-labelledby="predictive-search-articles"
        >
          {%- for article in predictive_search.resources.articles -%}
            <li class="predictive-search__item" role="option">
              <a class="predictive-search__link" href="{{ article.url }}">
                <span class="predictive-search__title">{{ article.title }}</span>
              </a>
            </li>
          {%- endfor -%}
        </ul>
      {%- endif -%}
    </div>

    {%- if found_any -%}
      <div class="predictive-search__footer">
        <a
          class="predictive-search__view-all"
          href="{{ routes.search_url }}?q={{ predictive_search.terms | url_encode }}"
        >
          View all results for "{{ predictive_search.terms }}"
        </a>
      </div>
    {%- endif -%}

    {%- unless found_any -%}
      <div class="predictive-search__no-results">
        <p class="predictive-search__no-results-text">No suggestions for "{{ predictive_search.terms }}".</p>
      </div>
    {%- endunless -%}
  </div>

{%- else -%}
  {%- comment -%} Show trending searches and popular products when no search is performed {%- endcomment -%}
  {% comment %}
    <div class="predictive-search__default">
      <div class="predictive-search__trending">
        <h3 class="predictive-search__heading">Trending Searches</h3>
        <ul class="predictive-search__trending-list">
          {%- for keyword in trending_keywords -%}
            <li class="predictive-search__trending-item">
              <a class="predictive-search__trending-link" href="{{ routes.search_url }}?q={{ keyword | url_encode }}">
                {{ keyword }}
              </a>
            </li>
          {%- endfor -%}
        </ul>
      </div>

      {%- if popular_products.size > 0 -%}
        <div class="predictive-search__popular">
          <h3 class="predictive-search__heading">Most Popular</h3>
          <ul class="predictive-search__list predictive-search__list--popular">
            {%- for product in popular_products -%}
              <li class="predictive-search__item" role="option">
                <a class="predictive-search__link" href="{{ product.url }}">
                  {{
                    product
                    | image_url: width: 244
                    | image_tag: alt: product.title, loading: 'lazy', class: 'predictive-search__image'
                  }}
                  <span class="predictive-search__title">{{ product.title }}</span>
                  {%- if product.price -%}
                    <span class="predictive-search__price">
                      {%- if product.compare_at_price > product.price -%}
                        <s>{{ product.compare_at_price | money }}</s>
                      {%- endif -%}
                      {{ product.price | money }}
                    </span>
                  {%- endif -%}
                </a>
              </li>
            {%- endfor -%}
          </ul>
        </div>
      {%- endif -%}
    </div>
  {% endcomment %}
{%- endif -%}
