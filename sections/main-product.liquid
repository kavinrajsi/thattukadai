{% comment %}
  sections/main-product.liquid
  - Uses custom 'product-media' snippet for gallery
  - Uses 'variant-picker' snippet for options (swatches + selects)
  - Simple product form with qty + add to cart
{% endcomment %}
<section id="product-{{ section.id }}" class="layout__grid-box main-product">
  {% if product == blank %}
    <p class="product__empty">No product selected.</p>
    {% comment %} In Theme Editor, choose a product for this section. {% endcomment %}
  {% else %}
    <div class="product__grid">
      <div class="product__image-col">
        {% render 'product-media', product: product %}
      </div>

      <div class="product__info-col">
        <h1 class="product__title">{{ product.title }}</h1>

        {% if product.description != blank and section.settings.show_description %}
          <div class="product__description rte">
            {{ product.description }}
          </div>
        {% endif %}

        <div class="product__price">
          {% render 'product-price', product: product, current_variant: product.selected_or_first_available_variant %}
        </div>

        <div class="product__meta">
          <p class="product__sku">
            <strong>SKU:</strong> <span id="variant-sku">{{ product.selected_or_first_available_variant.sku }}</span>
          </p>
          <p class="product__brand"><strong>Brand:</strong> {{ product.vendor }}</p>
          <p class="product__type"><strong>Type:</strong> {{ product.type }}</p>
          <p class="product__inventory" id="inventory-info"></p>

          {% if product.collections.size > 0 %}
            <p class="product__category">
              <strong>Category:</strong>
              {% for collection in product.collections %}
                <a href="{{ collection.url }}">{{ collection.title }}</a>
                {%- unless forloop.last %}, {% endunless %}
              {% endfor %}
            </p>
          {% endif %}

          {% if product.tags.size > 0 %}
            <p class="product__tags">
              <strong>Tags:</strong>
              {% for tag in product.tags %}
                <a href="/collections/all/{{ tag | handle }}">{{ tag }}</a>
                {%- unless forloop.last %}, {% endunless %}
              {% endfor %}
            </p>
          {% endif %}
        </div>

        {%- assign current_variant = product.selected_or_first_available_variant -%}
        {%- assign form_id = 'product-form-' | append: section.id -%}

        {% form 'product', product, id: form_id, novalidate: 'novalidate', class: 'product__form' %}
          {% render 'variant-picker', product: product, form_id: form_id, option_blocks: section.blocks %}

          <div class="product__actions">
            <div class="product__actionWrapper">
              {% if section.settings.show_quantity %}
                {% render 'product-qty', section_id: section.id, class: 'product__qty' %}
              {% endif %}

              <input type="hidden" class="product__input--variant" name="id" value="{{ current_variant.id }}">

              <button
                type="submit"
                name="add"
                class="product__btn--add-cart"
                {% unless current_variant.available %}
                  disabled
                {% endunless %}
              >
                {%- if current_variant.available -%}Add to cart{%- else -%}Sold out{%- endif -%}
              </button>
            </div>
            <button type="submit" class="product__btn--buy-now" name="checkout" value="true">Buy Now</button>
          </div>
        {% endform %}
      </div>
    </div>
  {% endif %}
</section>
{% schema %}
{
  "name": "Main product (custom)",
  "settings": [
    {
      "type": "product",
      "id": "product",
      "label": "Product (leave blank on product template)"
    },
    {
      "type": "checkbox",
      "id": "use_custom_gallery",
      "label": "Use custom media gallery (Swiper + PhotoSwipe)",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "include_swiper_assets",
      "label": "Include Swiper assets from theme Assets",
      "default": true,
      "info": "Requires swiper-bundle.min.css and swiper-bundle.min.js in Assets."
    },
    {
      "type": "checkbox",
      "id": "include_photoswipe_assets",
      "label": "Include PhotoSwipe assets from theme Assets",
      "default": true,
      "info": "Requires photoswipe.css, photoswipe.umd.min.js, photoswipe-lightbox.umd.min.js in Assets."
    },
    {
      "type": "checkbox",
      "id": "show_quantity",
      "label": "Show quantity selector",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_dynamic_checkout",
      "label": "Show dynamic checkout button",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_description",
      "label": "Show product description",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "option_style",
      "name": "Option display",
      "settings": [
        { "type": "text", "id": "option_name", "label": "Option name (e.g., Color, Size)" },
        {
          "type": "select",
          "id": "display",
          "label": "Display type",
          "default": "swatch",
          "options": [
            { "value": "swatch", "label": "Swatch" },
            { "value": "select", "label": "Select" }
          ]
        },
        { "type": "text", "id": "custom_label", "label": "Label override (optional)" }
      ]
    }
  ],
  "enabled_on": {
    "templates": ["product"]
  }
}
{% endschema %}
